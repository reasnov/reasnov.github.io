---
import AppLayout from "./AppLayout.astro";
import ReadingProgressBar from "@components/ui/ReadingProgressBar.astro";
import { trans } from "@core/Translator";

interface Props {
	title: string;
	date?: Date;
	readingTime?: number;
	schema?: object;
	headings?: { depth: number; slug: string; text: string }[];
}

const { title, date, readingTime, schema, headings = [] } = Astro.props;
const locale = Astro.currentLocale || "en";

const filteredHeadings = headings.filter((h) => h.depth > 1 && h.depth < 4);
---

<AppLayout title={title} schema={schema}>
	<ReadingProgressBar />

	<div class="relative flex flex-col gap-12 py-8 lg:flex-row">
		<!-- Main Content -->
		<article class="prose dark:prose-invert max-w-none flex-1">
			<div class="mb-12 border-b-2 border-border pb-8">
				<h1 class="mb-4 leading-none font-black tracking-tighter uppercase">{title}</h1>
				<div
					class="flex flex-wrap items-center gap-4 text-[10px] font-bold tracking-widest text-content/50 uppercase"
				>
					{
						date && (
							<div class="flex items-center gap-2">
								<span class="icon-[tabler--calendar] size-3" />
								{date.toLocaleDateString(locale, { year: "numeric", month: "long", day: "numeric" })}
							</div>
						)
					}
					{
						readingTime !== undefined && (
							<div class="flex items-center gap-2">
								<span class="icon-[tabler--clock] size-3" />
								{trans("blog.reading_time", { minutes: readingTime }, locale)}
							</div>
						)
					}
				</div>
			</div>

			<slot />
		</article>

		<!-- Sidebar / ToC -->
		{
			filteredHeadings.length > 0 && (
				<aside class="w-full shrink-0 lg:w-64">
					<div class="sticky top-24">
						<div class="tui-window">
							<div class="tui-window-header">
								<span>CONTENTS.LOG</span>
							</div>
							<nav class="flex flex-col gap-2 p-4">
								{filteredHeadings.map((h) => (
									<a
										href={`#${h.slug}`}
										class={`hover:text-accent line-clamp-2 text-[10px] font-bold tracking-tight uppercase transition-colors ${h.depth === 3 ? "border-l border-border/10 pl-4" : ""}`}
									>
										{h.depth === 2 ? "> " : "- "}
										{h.text}
									</a>
								))}
							</nav>
						</div>

						<div class="tui-panel mt-6 p-4 text-[10px] leading-tight font-bold text-content/40 uppercase">
							<p class="mb-2">TIP:</p>
							<p>
								Press <span class="text-accent">[T]</span> to switch theme or{" "}
								<span class="text-accent">[CTRL+K]</span> for command palette.
							</p>
						</div>
					</div>
				</aside>
			)
		}
	</div>
</AppLayout>
