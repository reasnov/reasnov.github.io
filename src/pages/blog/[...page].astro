---
import AppLayout from "@layouts/AppLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths, Page } from "astro";
import type { CollectionEntry } from "astro:content";

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
	const blogs = await getCollection("blog");

	blogs.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
	return paginate(blogs, { pageSize: 15 });
};

const { page } = Astro.props as { page: Page<CollectionEntry<"blog">> };

const today = new Date();
const oneWeekAgo = new Date(today);
oneWeekAgo.setDate(today.getDate() - 7);
---

<AppLayout>
	<h1 class="text-xl font-bold">Blog</h1>

	<div class="flex flex-col w-full gap-6 px-12">
		<!-- Map Blogs -->
		{
			page.data.map((blog) => {
				const postDate = blog.data.date;
				const isNew = postDate >= oneWeekAgo;

				return (
					<div class="flex items-center justify-between p-3 transition-all ease-in-out border-y border-neutral-800 hover:bg-neutral-800">
						<div class="flex items-center gap-6">
							{isNew && <span class="font-medium text-emerald-500 animate-blink">NEW!</span>}
							<a href={`/blog/${blog.id}`} class="w-full font-bold truncate">
								{blog.data.title}
							</a>
						</div>
						<div class="text-sm font-medium text-neutral-600">
							<span>
								{postDate
									? `[ ${postDate.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" })} ]`
									: ""}
							</span>
						</div>
					</div>
				);
			})
		}
	</div>

	<div class="flex items-center justify-center gap-6 my-6">
		{
			page.url.prev && (
				<a href={page.url.prev} class="btn btn-outline btn-secondary">
					&laquo; Previous
				</a>
			)
		}
		{
			page.url.next && (
				<a href={page.url.next} class="btn btn-outline btn-secondary">
					Next &raquo;
				</a>
			)
		}
	</div>
</AppLayout>
