---
import AppLayout from "@layouts/AppLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths, Page } from "astro";
import type { CollectionEntry } from "astro:content";
import { trans } from "@core/Translator";

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
	const blogs = await getCollection("blog", (entry) => {
		const isNotDraft = import.meta.env.PROD ? !entry.data.draft : true;
		return isNotDraft && entry.id.startsWith("id/");
	});

	blogs.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
	return paginate(blogs, { pageSize: 15 });
};

const { page } = Astro.props as { page: Page<CollectionEntry<"blog">> };
const locale = Astro.currentLocale || "en";

const today = new Date();
const oneWeekAgo = new Date(today);
oneWeekAgo.setDate(today.getDate() - 7);
---

<AppLayout>
	<div class="flex flex-col gap-8 my-10" data-aos="fade-up">
		<h1 class="text-4xl font-bold border-b-4 border-primary pb-2 w-fit">{trans("nav.blog", {}, locale)}</h1>

		<div class="flex flex-col w-full">
			{
				page.data.map((blog) => {
					const postDate = blog.data.pubDate;
					const isNew = postDate >= oneWeekAgo;

					return (
						<div 
							class="flex flex-col md:flex-row md:items-center justify-between py-6 border-b border-neutral-100 dark:border-neutral-900 group hover:bg-neutral-50 dark:hover:bg-neutral-900/30 px-4 transition-colors"
							data-aos="fade-up"
						>
							<div class="flex items-center gap-4 flex-1">
								{isNew && <span class="text-[10px] font-bold text-emerald-500 border border-emerald-500 px-2 py-0.5 rounded animate-pulse">BARU</span>}
								<a href={`/id/blog/${blog.id.replace("id/", "")}`} class="text-xl font-bold group-hover:text-primary transition-colors">
									{blog.data.title}
								</a>
							</div>
							<div class="text-sm font-bold text-neutral-400 mt-2 md:mt-0">
								{postDate.toLocaleDateString(locale, { year: "numeric", month: "long", day: "numeric" })}
							</div>
						</div>
					);
				})
			}
		</div>

		<div class="flex items-center justify-center gap-6 my-10">
			{
				page.url.prev && (
					<a href={page.url.prev} class="btn btn-outline btn-sm">
						&laquo; {trans("blog.prev", {}, locale)}
					</a>
				)
			}
			{
				page.url.next && (
					<a href={page.url.next} class="btn btn-outline btn-sm">
						{trans("blog.next", {}, locale)} &raquo;
					</a>
				)
			}
		</div>
	</div>
</AppLayout>
