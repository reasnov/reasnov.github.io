---
/**
 * ThemeSwitcher Component
 * Supports multiple instances by using classes instead of IDs.
 */
---

<button class="theme-toggle-btn hover:text-accent p-1 transition-colors focus:outline-none" aria-label="Toggle theme">
	<span class="dark-icon icon-[tabler--moon] hidden size-4"></span>
	<span class="light-icon icon-[tabler--sun] hidden size-4"></span>
</button>

<script>
	function updateIcons() {
		const isDark = document.documentElement.classList.contains("dark");
		document.querySelectorAll(".theme-toggle-btn").forEach((btn) => {
			const darkIcon = btn.querySelector(".dark-icon");
			const lightIcon = btn.querySelector(".light-icon");
			if (isDark) {
				lightIcon?.classList.remove("hidden");
				darkIcon?.classList.add("hidden");
			} else {
				darkIcon?.classList.remove("hidden");
				lightIcon?.classList.add("hidden");
			}
		});
	}

	function toggleTheme() {
		const isDark = document.documentElement.classList.toggle("dark");
		localStorage.setItem("color-theme", isDark ? "dark" : "light");
		updateIcons();
	}

	// Initialize
	if (
		localStorage.getItem("color-theme") === "dark" ||
		(!("color-theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)
	) {
		document.documentElement.classList.add("dark");
	} else {
		document.documentElement.classList.remove("dark");
	}
	updateIcons();

	// Add Listeners
	document.querySelectorAll(".theme-toggle-btn").forEach((btn) => {
		btn.addEventListener("click", toggleTheme);
	});

	// Listen for custom theme toggle events (from command palette)
	window.addEventListener("theme-toggle", toggleTheme);
</script>
