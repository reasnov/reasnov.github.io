---
import { getCollection } from "astro:content";
import { trans } from "@core/Translator";
import { getRelativeLocaleUrl } from "astro:i18n";
import { getReadingTime } from "@core/Content";

const locale = Astro.currentLocale || "en";

const posts = await getCollection("blog", (entry) => {
	const isNotDraft = import.meta.env.PROD ? !entry.data.draft : true;
	return isNotDraft && entry.id.startsWith(`${locale}/`);
});

const latestPosts = posts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()).slice(0, 3);
---

<section class="my-20 flex w-full flex-col gap-6" data-aos="fade-in">
	<div class="border-border flex items-center justify-between border-b-2 pb-2">
		<h2 class="text-xl font-black tracking-widest uppercase">&gt; {trans("latest_blog.title", {}, locale)}</h2>
		<a href={getRelativeLocaleUrl(locale, "blog")} class="tui-btn-secondary tui-btn-sm">
			{trans("latest_blog.view_all", {}, locale)}
		</a>
	</div>

	<div class="grid grid-cols-1 gap-6 md:grid-cols-3">
		{
			latestPosts.map((post, index) => {
				const readingTime = getReadingTime(post.body ?? "");
				return (
					<a
						href={getRelativeLocaleUrl(locale, `blog/${post.id.replace(`${locale}/`, "")}`)}
						class="group tui-panel flex flex-col gap-4 border-border/20 transition-all hover:border-accent hover:bg-primary/5"
						data-aos="fade-up"
						data-aos-delay={index * 100}
					>
						<div class="flex items-start justify-between">
							<span class="text-[9px] font-bold text-content/50 uppercase">
								{post.data.pubDate.toLocaleDateString(locale, {
									year: "numeric",
									month: "2-digit",
									day: "2-digit",
								})}
							</span>
							<span class="border-accent text-accent border px-1 text-[9px] font-bold">
								{readingTime}m_read
							</span>
						</div>

						<h3 class="line-clamp-2 text-base leading-tight font-bold transition-colors group-hover:underline decoration-accent decoration-2 underline-offset-4">
							{post.data.title}
						</h3>

						<p class="line-clamp-3 text-xs text-content/60">{post.data.description}</p>

						<div class="mt-auto flex items-center justify-between border-t border-border/10 pt-4">
							<div class="flex gap-2">
								{post.data.tags?.slice(0, 1).map((tag) => (
									<span class="text-[8px] font-bold text-content/40 uppercase">#{tag}</span>
								))}
							</div>
							<span class="icon-[tabler--chevron-right] size-4 text-content/20 transition-all group-hover:translate-x-1 group-hover:text-accent" />
						</div>
					</a>
				);
			})
		}
	</div>
</section>
