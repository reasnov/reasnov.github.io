---
import Brand from "@components/ui/Brand.astro";
import LangSwitcher from "@components/ui/LangSwitcher.astro";
import ThemeSwitcher from "@components/ui/ThemeSwitcher.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { trans } from "@core/Translator";
import { app_info } from "@core/AppInfo";

const lang = Astro.currentLocale || "en";
const version = app_info("app.version");
---

<nav class="border-border bg-bg sticky top-0 z-50 w-full border-b-2">
	<div class="container mx-auto">
		<!-- Top status bar look -->
		<div class="flex h-12 items-center justify-between px-4">
			<div class="flex items-center gap-6">
				<Brand />

				<div class="hidden items-center gap-4 text-xs font-bold tracking-tighter uppercase md:flex">
					<a href={getRelativeLocaleUrl(lang, "blog")} class="hover:text-accent transition-colors">
						&lt;{trans("nav.blog", {}, lang)}&gt;
					</a>
					<span class="text-fg/20">|</span>
					<a href="https://medium.com/reasnov" class="hover:text-accent transition-colors">
						&lt;{trans("nav.medium", {}, lang)}&gt;
					</a>
				</div>
			</div>

			<div class="flex h-12 items-center gap-4">
				<!-- Command Palette Trigger Hint -->
				<button 
					onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
					class="hidden items-center gap-2 px-3 py-1 border border-border/20 hover:border-accent group transition-all md:flex"
				>
					<span class="icon-[tabler--search] size-3 text-fg/40 group-hover:text-accent"></span>
					<span class="text-[10px] font-bold text-fg/40 group-hover:text-accent uppercase">Search</span>
					<div class="flex items-center gap-1 ml-2">
						<kbd class="group-hover:border-accent group-hover:text-accent transition-colors">CTRL</kbd>
						<kbd class="group-hover:border-accent group-hover:text-accent transition-colors">K</kbd>
					</div>
				</button>

				<div class="border-border/10 hidden h-12 items-center gap-2 border-x px-4 md:flex">
					<ThemeSwitcher />
					<LangSwitcher />
				</div>

				<div class="text-fg/50 hidden items-center gap-3 md:flex">
					<a
						href="https://github.com/reasnov"
						target="__blank"
						class="icon-[tabler--brand-github] hover:text-fg transition-colors"></a>
					<a
						href="https://linkedin.com/in/reasnov"
						target="__blank"
						class="icon-[tabler--brand-linkedin] hover:text-fg transition-colors"></a>
				</div>

				<!-- Mobile Menu Button -->
				<button id="mobile-menu-toggle" class="tui-btn-primary tui-btn-sm md:hidden">
					<span id="menu-icon-open">[MENU]</span>
					<span id="menu-icon-close" class="hidden">[CLOSE]</span>
				</button>
			</div>
		</div>
	</div>

	<!-- Mobile Menu Overlay -->
	<div id="mobile-menu" class="bg-bg fixed inset-0 z-40 hidden pt-12">
		<div class="flex flex-col gap-8 p-4">
			<div class="tui-window">
				<div class="tui-window-header">
					<span>NAVIGATION.SYS</span>
				</div>
				<div class="flex flex-col">
					<a
						href={getRelativeLocaleUrl(lang, "/")}
						class="border-border/10 hover:bg-primary hover:text-primary-fg border-b p-4 text-lg font-black uppercase"
					>
						&gt; {trans("nav.home", {}, lang) || "Home"}
					</a>
					<a
						href={getRelativeLocaleUrl(lang, "blog")}
						class="border-border/10 hover:bg-primary hover:text-primary-fg border-b p-4 text-lg font-black uppercase"
					>
						&gt; {trans("nav.blog", {}, lang)}
					</a>
					<a
						href="https://medium.com/reasnov"
						class="border-border/10 hover:bg-primary hover:text-primary-fg border-b p-4 text-lg font-black uppercase"
					>
						&gt; {trans("nav.medium", {}, lang)}
					</a>
				</div>
			</div>

			<div class="tui-window">
				<div class="tui-window-header">
					<span>SETTINGS.EXE</span>
				</div>
				<div class="flex flex-col gap-6 p-4">
					<div class="flex items-center justify-between">
						<span class="text-xs font-bold tracking-widest uppercase">Theme:</span>
						<ThemeSwitcher />
					</div>
					<div class="flex items-center justify-between">
						<span class="text-xs font-bold tracking-widest uppercase">Language:</span>
						<LangSwitcher />
					</div>
				</div>
			</div>

			<div class="tui-window">
				<div class="tui-window-header">
					<span>SOCIAL.LOG</span>
				</div>
				<div class="flex justify-around p-4">
					<a
						href="https://github.com/reasnov"
						target="__blank"
						class="icon-[tabler--brand-github] size-8 text-neutral-500 transition-colors hover:text-black dark:hover:text-white"
					></a>
					<a
						href="https://x.com/reasnov"
						target="__blank"
						class="icon-[tabler--brand-x] size-8 text-neutral-500 transition-colors hover:text-black dark:hover:text-white"
					></a>
					<a
						href="https://linkedin.com/in/reasnov"
						target="__blank"
						class="icon-[tabler--brand-linkedin] size-8 text-neutral-500 transition-colors hover:text-black dark:hover:text-white"
					></a>
				</div>
			</div>

			<p class="mt-auto text-center text-[10px] font-bold tracking-[0.3em] text-neutral-500 uppercase">
				System: {version} // Root: me
			</p>
		</div>
	</div>
</nav>

<script>
	const btn = document.getElementById("mobile-menu-toggle");
	const menu = document.getElementById("mobile-menu");
	const iconOpen = document.getElementById("menu-icon-open");
	const iconClose = document.getElementById("menu-icon-close");

	btn?.addEventListener("click", () => {
		const isOpen = !menu?.classList.contains("hidden");

		if (isOpen) {
			menu?.classList.add("hidden");
			iconOpen?.classList.remove("hidden");
			iconClose?.classList.add("hidden");
			document.body.style.overflow = "auto";
		} else {
			menu?.classList.remove("hidden");
			iconOpen?.classList.add("hidden");
			iconClose?.classList.remove("hidden");
			document.body.style.overflow = "hidden";
		}
	});

	// Close menu when a link is clicked
	const links = menu?.querySelectorAll("a");
	links?.forEach((link) => {
		link.addEventListener("click", () => {
			menu?.classList.add("hidden");
			iconOpen?.classList.remove("hidden");
			iconClose?.classList.add("hidden");
			document.body.style.overflow = "auto";
		});
	});
</script>
