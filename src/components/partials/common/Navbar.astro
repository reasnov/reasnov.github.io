---
import Brand from "@components/ui/Brand.astro";
import LangSwitcher from "@components/ui/LangSwitcher.astro";
import ThemeSwitcher from "@components/ui/ThemeSwitcher.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { trans } from "@core/Translator";
import { app_info } from "@core/AppInfo";

const lang = Astro.currentLocale || "en";
const version = app_info("app.version");

const navLinks = [
	{ key: "home", path: "/" },
	{ key: "blog", path: "blog" },
	{ key: "showcase", path: "showcase" },
	{ key: "playgrounds", path: "playgrounds" },
];
---

<nav class="border-border bg-bg/90 sticky top-0 z-50 w-full border-b-2 backdrop-blur-md">
	<div class="tui-container">
		<div class="flex h-16 items-center justify-between gap-4">
			<!-- LEFT: Brand -->
			<div class="flex shrink-0 items-center">
				<Brand />
			</div>

			<!-- CENTER: Nav Links (Visible on LG) -->
			<div class="hidden flex-1 items-center justify-center gap-1 lg:flex">
				{
					navLinks.map((item) => (
						<a
							href={getRelativeLocaleUrl(lang, item.path)}
							class="tui-btn-ghost text-fg/60 hover:text-accent text-[10px] font-bold tracking-widest uppercase"
						>
							&lt;{trans(`nav.${item.key}`, {}, lang)}&gt;
						</a>
					))
				}
			</div>

			<!-- RIGHT: Social + Switchers + Search (Visible on LG) -->
			<div class="flex items-center gap-2 md:gap-4">
				<!-- Search Trigger -->
				<button
					onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
					class="border-border/20 group hover:border-accent hidden items-center gap-2 border px-3 py-1.5 transition-all lg:flex"
				>
					<span class="icon-[tabler--search] text-fg/40 group-hover:text-accent size-3"></span>
					<div class="flex items-center gap-1">
						<kbd class="group-hover:border-accent group-hover:text-accent transition-colors">CTRL</kbd>
						<kbd class="group-hover:border-accent group-hover:text-accent transition-colors">K</kbd>
					</div>
				</button>

				<!-- Social Links (Visible on LG) -->
				<div class="border-border/10 hidden items-center gap-3 border-x px-4 lg:flex">
					<a
						href="https://github.com/reasnov"
						target="_blank"
						class="tui-btn-ghost text-fg/40 hover:text-fg p-1"
					>
						<span class="icon-[tabler--brand-github] size-4"></span>
					</a>
					<a
						href="https://linkedin.com/in/reasnov"
						target="_blank"
						class="tui-btn-ghost text-fg/40 hover:text-fg p-1"
					>
						<span class="icon-[tabler--brand-linkedin] size-4"></span>
					</a>
					<a
						href="https://medium.com/@reasnov"
						target="_blank"
						class="tui-btn-ghost text-fg/40 hover:text-fg p-1"
					>
						<span class="icon-[tabler--brand-medium] size-4"></span>
					</a>
				</div>

				<!-- Switchers (Visible on LG) -->
				<div class="hidden items-center gap-2 lg:flex">
					<ThemeSwitcher />
					<LangSwitcher />
				</div>

				<!-- Mobile Menu Button (Hidden on LG) -->
				<button id="mobile-menu-toggle" class="tui-btn-primary tui-btn-sm lg:hidden">
					<span id="menu-icon-open">[MENU]</span>
					<span id="menu-icon-close" class="hidden">[CLOSE]</span>
				</button>
			</div>
		</div>
	</div>

	<!-- MOBILE MENU OVERLAY -->
	<div id="mobile-menu" class="bg-bg border-border fixed inset-0 z-40 hidden flex-col border-t-2 pt-16 lg:hidden">
		<div class="tui-container flex flex-1 flex-col gap-8 overflow-y-auto pt-4 pb-12">
			<!-- Dedicated Mobile Header with Close -->
			<div class="border-border/10 flex items-center justify-between border-b pb-4">
				<div class="flex items-center gap-2">
					<span class="bg-accent size-2 animate-pulse"></span>
					<span class="text-fg/40 text-[10px] font-bold tracking-widest uppercase">System Menu</span>
				</div>
				<button id="mobile-menu-close" class="tui-btn-secondary tui-btn-sm"> [CLOSE_X] </button>
			</div>

			<!-- Search / Command Palette Shortcut -->
			<button
				onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
				class="tui-panel tui-panel-muted hover:border-accent group flex items-center justify-between border-dashed transition-colors"
			>
				<div class="flex items-center gap-3">
					<span class="icon-[tabler--terminal] text-accent size-5"></span>
					<span class="text-xs font-bold tracking-widest uppercase">Launch Command Palette</span>
				</div>
				<kbd class="group-hover:border-accent transition-colors">/</kbd>
			</button>

			<!-- Nav Section -->
			<div class="tui-window">
				<div class="tui-window-header">
					<span>DIRECTORY_NAV.SYS</span>
				</div>
				<div class="flex flex-col">
					{
						navLinks.map((item) => (
							<a
								href={getRelativeLocaleUrl(lang, item.path)}
								class="border-border/5 hover:bg-primary hover:text-primary-fg active:bg-accent active:text-accent-fg border-b p-5 text-lg font-black uppercase transition-colors"
							>
								&gt; {trans(`nav.${item.key}`, {}, lang)}
							</a>
						))
					}
				</div>
			</div>

			<!-- Settings Section -->
			<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
				<div class="tui-window">
					<div class="tui-window-header">
						<span>THEME_CONFIG.EXE</span>
					</div>
					<div class="flex items-center justify-between p-4">
						<span class="text-[10px] font-bold tracking-widest uppercase opacity-50">Visual Mode:</span>
						<ThemeSwitcher />
					</div>
				</div>
				<div class="tui-window">
					<div class="tui-window-header">
						<span>LOCALE_SET.EXE</span>
					</div>
					<div class="flex items-center justify-between p-4">
						<span class="text-[10px] font-bold tracking-widest uppercase opacity-50">Active Lang:</span>
						<LangSwitcher />
					</div>
				</div>
			</div>

			<!-- Social Section -->
			<div class="tui-window">
				<div class="tui-window-header">
					<span>AUTH_SOCIAL.LOG</span>
				</div>
				<div class="flex justify-around p-6">
					<a href="https://github.com/reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl">
						<span class="icon-[tabler--brand-github]"></span>
					</a>
					<a href="https://linkedin.com/in/reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl">
						<span class="icon-[tabler--brand-linkedin]"></span>
					</a>
					<a href="https://medium.com/@reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl">
						<span class="icon-[tabler--brand-medium]"></span>
					</a>
					<a href="https://x.com/reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl">
						<span class="icon-[tabler--brand-x]"></span>
					</a>
				</div>
			</div>

			<!-- Footer -->
			<div class="border-border/5 mt-auto flex flex-col items-center gap-4 border-t py-4">
				<p class="text-fg/30 text-center text-[9px] font-bold tracking-[0.4em] uppercase">
					KERNEL: {version} // ROOT: Andreas Novyanto
				</p>
			</div>
		</div>
	</div>
</nav>

<script>
	const btn = document.getElementById("mobile-menu-toggle");
	const closeBtn = document.getElementById("mobile-menu-close");
	const menu = document.getElementById("mobile-menu");
	const iconOpen = document.getElementById("menu-icon-open");
	const iconClose = document.getElementById("menu-icon-close");

	function toggleMenu() {
		const isOpen = !menu?.classList.contains("hidden");
		if (isOpen) {
			menu?.classList.add("hidden");
			menu?.classList.remove("flex");
			iconOpen?.classList.remove("hidden");
			iconClose?.classList.add("hidden");
			document.body.style.overflow = "auto";
		} else {
			menu?.classList.remove("hidden");
			menu?.classList.add("flex");
			iconOpen?.classList.add("hidden");
			iconClose?.classList.remove("hidden");
			document.body.style.overflow = "hidden";
		}
	}

	btn?.addEventListener("click", toggleMenu);
	closeBtn?.addEventListener("click", toggleMenu);

	const links = menu?.querySelectorAll("a");
	links?.forEach((link) => {
		link.addEventListener("click", () => {
			if (!menu?.classList.contains("hidden")) toggleMenu();
		});
	});
</script>
