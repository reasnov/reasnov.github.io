---
import Brand from "@components/ui/Brand.astro";
import LangSwitcher from "@components/ui/LangSwitcher.astro";
import ThemeSwitcher from "@components/ui/ThemeSwitcher.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { trans } from "@core/Translator";
import { app_info } from "@core/AppInfo";

const lang = Astro.currentLocale || "en";
const version = app_info("app.version");

const navLinks = [
	{ key: "home", path: "/" },
	{ key: "blog", path: "blog" },
	{ key: "showcase", path: "showcase" },
	{ key: "playgrounds", path: "playgrounds" },
];

const socialLinks = [
	{
		name: "GitHub",
		url: "https://github.com/reasnov",
		icon: "icon-[tabler--brand-github]",
		color: "hover:text-t-cyan",
	},
	{
		name: "LinkedIn",
		url: "https://linkedin.com/in/reasnov",
		icon: "icon-[tabler--brand-linkedin]",
		color: "hover:text-t-blue",
	},
	{
		name: "Medium",
		url: "https://medium.com/@reasnov",
		icon: "icon-[tabler--brand-medium]",
		color: "hover:text-t-magenta",
	},
];
---

<!-- NAVBAR (Z-10) -->
<nav class="border-border bg-base/90 fixed top-0 right-0 left-0 z-10 w-full border-b-2 backdrop-blur-md">
	<div class="container mx-auto px-4 md:px-8">
		<div class="flex h-16 items-center justify-between gap-4">
			<Brand />

			<!-- Desktop Nav -->
			<div class="hidden flex-1 items-center justify-center gap-2 lg:flex">
				{
					navLinks.map((item) => (
						<a
							href={getRelativeLocaleUrl(lang, item.path)}
							class="text-content/60 hover:text-accent px-4 py-1 text-[10px] font-black tracking-[0.2em] uppercase transition-colors"
						>
							[{trans(`nav.${item.key}`, {}, lang)}]
						</a>
					))
				}
			</div>

			<div class="flex items-center gap-2">
				<button
					onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
					class="border-border/20 hover:border-accent hidden items-center gap-2 border px-3 py-1 transition-all lg:flex"
				>
					<kbd class="text-[9px]">CTRL + K</kbd>
				</button>

				<div class="border-border/10 hidden h-16 items-center gap-4 border-x px-6 lg:flex">
					{
						socialLinks.map((link) => (
							<a
								href={link.url}
								target="_blank"
								class={`text-content/40 p-1 transition-colors ${link.color}`}
								title={link.name}
							>
								<span class={`${link.icon} size-4`} />
							</a>
						))
					}
				</div>

				<div class="hidden items-center gap-4 pr-4 lg:flex">
					<ThemeSwitcher />
					<LangSwitcher />
				</div>

				<button id="mobile-menu-toggle" class="tui-btn-primary px-4 py-1.5 lg:hidden">
					<span id="menu-label-open">[MENU]</span>
					<span id="menu-label-close" class="hidden">[CLOSE]</span>
				</button>
			</div>
		</div>
	</div>

	<!-- MOBILE MENU (Z-50) -->
	<div
		id="mobile-menu"
		class="bg-base border-border fixed inset-0 z-50 hidden h-screen w-screen flex-col border-t-2 lg:hidden"
	>
		<div class="no-scrollbar container mx-auto flex h-full flex-col gap-8 overflow-y-auto px-6 pt-24 pb-12">
			<div class="tui-window shrink-0">
				<div class="tui-window-header">
					<span>DIRECTORY_NAV.SYS</span>
					<button id="mobile-close-btn" class="text-accent font-black hover:underline">[X_CLOSE]</button>
				</div>
				<div class="flex flex-col">
					{
						navLinks.map((item) => (
							<a
								href={getRelativeLocaleUrl(lang, item.path)}
								class="border-border/5 hover:bg-primary hover:text-primary-content border-b p-6 text-2xl font-black uppercase transition-colors"
							>
								&gt; {trans(`nav.${item.key}`, {}, lang)}
							</a>
						))
					}
				</div>
			</div>

			<div class="grid shrink-0 grid-cols-1 gap-6 sm:grid-cols-2">
				<div class="tui-window">
					<div class="tui-window-header"><span>THEME_CONFIG.EXE</span></div>
					<div class="flex items-center justify-between p-6">
						<span class="text-xs font-black tracking-widest uppercase opacity-50">Visual Mode:</span>
						<div class="bg-primary/5 border-border/10 flex items-center border p-1">
							<ThemeSwitcher />
						</div>
					</div>
				</div>
				<div class="tui-window">
					<div class="tui-window-header"><span>LOCALE_SET.EXE</span></div>
					<div class="flex items-center justify-between p-6">
						<span class="text-xs font-black tracking-widest uppercase opacity-50">Lang Select:</span>
						<LangSwitcher />
					</div>
				</div>
			</div>

			<div class="tui-window flex shrink-0 justify-around p-8">
				{
					socialLinks.map((link) => (
						<a
							href={link.url}
							target="_blank"
							class={`text-content/50 text-3xl transition-colors ${link.color}`}
						>
							<span class={link.icon} />
						</a>
					))
				}
			</div>

			<button
				onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
				class="tui-btn-primary w-full py-6 text-lg">EXECUTE_COMMAND_PALETTE [/]</button
			>
			<p class="text-content/30 mt-auto py-4 text-center text-[10px] font-black tracking-[0.5em] uppercase">
				KERNEL: {version} // @reasnov
			</p>
		</div>
	</div>
</nav>

<script>
	const menuToggle = document.getElementById("mobile-menu-toggle");
	const mobileClose = document.getElementById("mobile-close-btn");
	const mobileMenu = document.getElementById("mobile-menu");
	const labelOpen = document.getElementById("menu-label-open");
	const labelClose = document.getElementById("menu-label-close");

	function toggleMenu() {
		if (!mobileMenu) return;
		const isHidden = mobileMenu.classList.contains("hidden");
		if (isHidden) {
			mobileMenu.classList.remove("hidden");
			mobileMenu.classList.add("flex");
			labelOpen?.classList.add("hidden");
			labelClose?.classList.remove("hidden");
			document.body.style.overflow = "hidden";
		} else {
			mobileMenu.classList.add("hidden");
			mobileMenu.classList.remove("flex");
			labelOpen?.classList.remove("hidden");
			labelClose?.classList.add("hidden");
			document.body.style.overflow = "";
		}
	}

	menuToggle?.addEventListener("click", toggleMenu);
	mobileClose?.addEventListener("click", toggleMenu);
	mobileMenu
		?.querySelectorAll("a")
		.forEach((l) => l.addEventListener("click", () => !mobileMenu.classList.contains("hidden") && toggleMenu()));
</script>
