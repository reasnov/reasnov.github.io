---
import Brand from "@components/ui/Brand.astro";
import LangSwitcher from "@components/ui/LangSwitcher.astro";
import ThemeSwitcher from "@components/ui/ThemeSwitcher.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { trans } from "@core/Translator";
import { app_info } from "@core/AppInfo";

const lang = Astro.currentLocale || "en";
const version = app_info("app.version");

const navLinks = [
	{ key: "home", path: "/" },
	{ key: "blog", path: "blog" },
	{ key: "showcase", path: "showcase" },
	{ key: "playgrounds", path: "playgrounds" },
];
---

<nav class="sticky top-0 z-50 w-full border-b-2 border-border bg-base/90 backdrop-blur-md">
	<div class="tui-container">
		<div class="flex h-16 items-center justify-between gap-4">
			<!-- LEFT: Brand -->
			<div class="flex shrink-0 items-center">
				<Brand />
			</div>

			<!-- CENTER: Nav Links (Visible on LG) -->
			<div class="hidden flex-1 items-center justify-center gap-1 lg:flex">
				{
					navLinks.map((item) => (
						<a
							href={getRelativeLocaleUrl(lang, item.path)}
							class="tui-btn-ghost text-[10px] font-bold tracking-widest text-content/60 uppercase hover:text-accent"
						>
							&lt;{trans(`nav.${item.key}`, {}, lang)}&gt;
						</a>
					))
				}
			</div>

			<!-- RIGHT: Social + Switchers + Search (Visible on LG) -->
			<div class="flex items-center gap-2 md:gap-4">
				<!-- Search Trigger (Desktop) -->
				<button
					onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
					class="border-border/20 hidden items-center gap-2 border px-3 py-1.5 transition-all group lg:flex hover:border-accent"
				>
					<span class="icon-[tabler--search] size-3 text-content/40 group-hover:text-accent"></span>
					<div class="flex items-center gap-1">
						<kbd class="group-hover:border-accent group-hover:text-accent transition-colors">CTRL</kbd>
						<kbd class="group-hover:border-accent group-hover:text-accent transition-colors">K</kbd>
					</div>
				</button>

				<!-- Social Links (Desktop) -->
				<div class="border-border/10 hidden items-center gap-3 border-x px-4 lg:flex">
					<a href="https://github.com/reasnov" target="_blank" class="tui-btn-ghost p-1 text-content/40 hover:text-content">
						<span class="icon-[tabler--brand-github] size-4"></span>
					</a>
					<a href="https://linkedin.com/in/reasnov" target="_blank" class="tui-btn-ghost p-1 text-content/40 hover:text-content">
						<span class="icon-[tabler--brand-linkedin] size-4"></span>
					</a>
					<a href="https://medium.com/@reasnov" target="_blank" class="tui-btn-ghost p-1 text-content/40 hover:text-content">
						<span class="icon-[tabler--brand-medium] size-4"></span>
					</a>
				</div>

				<!-- Switchers (Desktop) -->
				<div class="hidden items-center gap-2 lg:flex">
					<ThemeSwitcher />
					<LangSwitcher />
				</div>

				<!-- Mobile Menu Toggle -->
				<button id="mobile-menu-toggle" class="tui-btn-primary tui-btn-sm lg:hidden">
					<span id="menu-label-open">[MENU]</span>
					<span id="menu-label-close" class="hidden">[CLOSE]</span>
				</button>
			</div>
		</div>
	</div>

	<!-- MOBILE MENU OVERLAY -->
	<div id="mobile-menu" class="bg-base fixed inset-0 z-[100] hidden flex-col border-t-2 border-border lg:hidden">
		<div class="tui-container flex h-full flex-col gap-8 overflow-y-auto pb-12 pt-8">
			<!-- Dedicated Mobile Header -->
			<div class="flex items-center justify-between border-b border-border/10 pb-4">
				<div class="flex items-center gap-2">
					<span class="size-2 animate-pulse bg-accent"></span>
					<span class="text-[10px] font-bold tracking-widest text-content/40 uppercase">System Menu</span>
				</div>
				<button id="mobile-menu-close-btn" class="tui-btn-secondary tui-btn-sm">
					[X_CLOSE]
				</button>
			</div>

			<!-- Search / Command Palette Shortcut (Mobile) -->
			<button
				onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
				class="tui-panel tui-panel-muted flex items-center justify-between border-dashed hover:border-accent group transition-colors"
			>
				<div class="flex items-center gap-3">
					<span class="icon-[tabler--terminal] size-5 text-accent"></span>
					<span class="text-xs font-bold tracking-widest uppercase">Launch Command Palette</span>
				</div>
				<kbd class="group-hover:border-accent transition-colors">/</kbd>
			</button>

			<!-- Navigation Links -->
			<div class="tui-window shrink-0">
				<div class="tui-window-header">
					<span>DIRECTORY_NAV.SYS</span>
				</div>
				<div class="flex flex-col">
					{
						navLinks.map((item) => (
							<a
								href={getRelativeLocaleUrl(lang, item.path)}
								class="border-b border-border/5 p-5 text-lg font-black transition-colors uppercase hover:bg-primary hover:text-primary-content active:bg-accent active:text-accent-content"
							>
								&gt; {trans(`nav.${item.key}`, {}, lang)}
							</a>
						))
					}
				</div>
			</div>

			<!-- Settings & Config -->
			<div class="grid shrink-0 grid-cols-1 gap-4 sm:grid-cols-2">
				<div class="tui-window">
					<div class="tui-window-header">
						<span>THEME_CONFIG.EXE</span>
					</div>
					<div class="flex items-center justify-between p-4">
						<span class="text-[10px] font-bold uppercase tracking-widest opacity-50">Visual Mode:</span>
						<ThemeSwitcher />
					</div>
				</div>
				<div class="tui-window">
					<div class="tui-window-header">
						<span>LOCALE_SET.EXE</span>
					</div>
					<div class="flex items-center justify-between p-4">
						<span class="text-[10px] font-bold uppercase tracking-widest opacity-50">Active Lang:</span>
						<LangSwitcher />
					</div>
				</div>
			</div>

			<!-- Social Connections -->
			<div class="tui-window shrink-0">
				<div class="tui-window-header">
					<span>AUTH_SOCIAL.LOG</span>
				</div>
				<div class="flex justify-around p-6">
					<a href="https://github.com/reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl shadow-none">
						<span class="icon-[tabler--brand-github]"></span>
					</a>
					<a href="https://linkedin.com/in/reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl shadow-none">
						<span class="icon-[tabler--brand-linkedin]"></span>
					</a>
					<a href="https://medium.com/@reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl shadow-none">
						<span class="icon-[tabler--brand-medium]"></span>
					</a>
					<a href="https://x.com/reasnov" target="_blank" class="tui-btn-secondary size-12 text-xl shadow-none">
						<span class="icon-[tabler--brand-x]"></span>
					</a>
				</div>
			</div>

			<!-- Footer Meta -->
			<div class="border-border/5 mt-auto flex shrink-0 flex-col items-center gap-4 border-t py-4">
				<p class="text-center text-[9px] font-bold tracking-[0.4em] text-content/30 uppercase">
					KERNEL: {version} // ROOT: Andreas Novyanto
				</p>
			</div>
		</div>
	</div>
</nav>

<script>
	const menuToggle = document.getElementById("mobile-menu-toggle");
	const menuCloseBtn = document.getElementById("mobile-menu-close-btn");
	const mobileMenu = document.getElementById("mobile-menu");
	const labelOpen = document.getElementById("menu-label-open");
	const labelClose = document.getElementById("menu-label-close");

	function toggleMenu() {
		if (!mobileMenu) return;
		
		const isHidden = mobileMenu.classList.contains("hidden");
		
		if (isHidden) {
			mobileMenu.classList.remove("hidden");
			mobileMenu.classList.add("flex");
			labelOpen?.classList.add("hidden");
			labelClose?.classList.remove("hidden");
			document.body.style.overflow = "hidden";
		} else {
			mobileMenu.classList.add("hidden");
			mobileMenu.classList.remove("flex");
			labelOpen?.classList.remove("hidden");
			labelClose?.classList.add("hidden");
			document.body.style.overflow = "";
		}
	}

	menuToggle?.addEventListener("click", toggleMenu);
	menuCloseBtn?.addEventListener("click", toggleMenu);

	const menuLinks = mobileMenu?.querySelectorAll("a");
	menuLinks?.forEach((link) => {
		link.addEventListener("click", () => {
			if (mobileMenu && !mobileMenu.classList.contains("hidden")) {
				toggleMenu();
			}
		});
	});
</script>
