---
import Brand from "@components/ui/Brand.astro";
import LangSwitcher from "@components/ui/LangSwitcher.astro";
import ThemeSwitcher from "@components/ui/ThemeSwitcher.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { trans } from "@core/Translator";
import { app_info } from "@core/AppInfo";

const lang = Astro.currentLocale || "en";
const version = app_info("app.version");

const navLinks = [
	{ key: "home", path: "/" },
	{ key: "blog", path: "blog" },
	{ key: "showcase", path: "showcase" },
	{ key: "playgrounds", path: "playgrounds" },
];
---

<nav class="border-border bg-base/90 sticky top-0 z-50 w-full border-b-2 backdrop-blur-md">
	<div class="container mx-auto px-4">
		<div class="flex h-14 items-center justify-between gap-4">
			<Brand />

			<!-- Desktop Nav -->
			<div class="hidden flex-1 items-center justify-center gap-1 lg:flex">
				{
					navLinks.map((item) => (
						<a
							href={getRelativeLocaleUrl(lang, item.path)}
							class="text-content/60 hover:text-accent px-3 py-1 text-[10px] font-bold tracking-widest uppercase transition-colors"
						>
							&lt;{trans(`nav.${item.key}`, {}, lang)}&gt;
						</a>
					))
				}
			</div>

			<div class="flex items-center gap-2">
				<!-- Search Hint -->
				<button
					onclick="window.dispatchEvent(new CustomEvent('open-palette'))"
					class="border-border/20 hover:border-accent hidden items-center gap-2 border px-2 py-1 transition-all lg:flex"
				>
					<kbd class="text-[9px]">CTRL + K</kbd>
				</button>

				<div class="border-border/10 hidden h-14 items-center gap-2 border-x px-4 lg:flex">
					<ThemeSwitcher />
					<LangSwitcher />
				</div>

				<button id="mobile-menu-toggle" class="tui-btn-primary lg:hidden">
					<span id="label-open">[MENU]</span>
					<span id="label-close" class="hidden">[CLOSE]</span>
				</button>
			</div>
		</div>
	</div>

	<!-- Mobile Menu -->
	<div id="mobile-menu" class="bg-base border-border fixed inset-0 z-[100] hidden flex-col border-t-2 lg:hidden">
		<div class="container mx-auto flex h-full flex-col gap-6 overflow-y-auto px-4 pt-20 pb-12">
			<div class="tui-window">
				<div class="tui-window-header"><span>DIRECTORY_NAV.SYS</span></div>
				<div class="flex flex-col">
					{
						navLinks.map((item) => (
							<a
								href={getRelativeLocaleUrl(lang, item.path)}
								class="border-border/5 hover:bg-primary hover:text-primary-content border-b p-4 text-lg font-black uppercase transition-colors"
							>
								&gt; {trans(`nav.${item.key}`, {}, lang)}
							</a>
						))
					}
				</div>
			</div>

			<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
				<div class="tui-window flex items-center justify-between p-4">
					<span class="text-[10px] font-bold uppercase opacity-50">Theme:</span>
					<ThemeSwitcher />
				</div>
				<div class="tui-window flex items-center justify-between p-4">
					<span class="text-[10px] font-bold uppercase opacity-50">Lang:</span>
					<LangSwitcher />
				</div>
			</div>

			<div class="tui-window flex justify-around p-6">
				<a href="https://github.com/reasnov" target="_blank" class="text-content/50 hover:text-content text-2xl"
					><span class="icon-[tabler--brand-github]"></span></a
				>
				<a
					href="https://linkedin.com/in/reasnov"
					target="_blank"
					class="text-content/50 hover:text-content text-2xl"
					><span class="icon-[tabler--brand-linkedin]"></span></a
				>
				<a
					href="https://medium.com/@reasnov"
					target="_blank"
					class="text-content/50 hover:text-content text-2xl"
					><span class="icon-[tabler--brand-medium]"></span></a
				>
			</div>

			<button onclick="window.dispatchEvent(new CustomEvent('open-palette'))" class="tui-btn-primary w-full py-4"
				>LAUNCH_PALETTE [/]</button
			>
			<p class="text-content/30 text-center text-[9px] font-bold tracking-[0.4em] uppercase">KERNEL: {version}</p>
		</div>
	</div>
</nav>

<script>
	const btn = document.getElementById("mobile-menu-toggle");
	const menu = document.getElementById("mobile-menu");
	const lOpen = document.getElementById("label-open");
	const lClose = document.getElementById("label-close");

	btn?.addEventListener("click", () => {
		const isHidden = menu?.classList.contains("hidden");
		menu?.classList.toggle("hidden", !isHidden);
		menu?.classList.toggle("flex", isHidden);
		lOpen?.classList.toggle("hidden", isHidden);
		lClose?.classList.toggle("hidden", !isHidden);
		document.body.style.overflow = isHidden ? "hidden" : "";
	});
</script>
